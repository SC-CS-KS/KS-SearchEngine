# 查询结果排序
```md
搜索结果排序是根据 关键字 和 Document 的相关性得分排序，通
常意义下，除了可以人工的设置权重 boost，也存在一套非常有用的相关性得分算法
```

## TF(词频)-IDF(逆文档频率) 
```md
在自动提取文章关键词上经常用到，通过它可以知道某个关键字在这篇文档里的重要程度。
```
```md
其中 TF 表示某个 Term 在 Document 里出现的频次，越高说明越重要；
DF 表示在全部 Document 里，共有多少个 Document 出现了这个词，DF 越大，说明这个词很常见，并不重要，
越小反而说明他越重要，IDF 是 DF 的倒数(取log)， IDF 越大，表示这个词越重要。
```
```md
假定现在有一篇博客《Blink 实战总结》，过滤掉停用词，只考虑剩下的有实际意义的词，
如果文章中词频数关系： “Blink” > “实战” = “总结”，那么肯定是 Blink 是这篇文章更重要的关键字。
但又会遇到了另一个问题，如果发现 "Blink"、"实战"、"总结"这三个词的出现次数一样多。

这是不是意味着，作为关键词，它们的重要性是一样的？
不是的，通过统计全部博客，你发现 含关键字总博客数： “Blink” < “实战” < “总结”，
这时候说明 “Blink” 不怎么常见，一旦出现，一定相比 “实战” 和 “总结”，对这篇文章的重要性更大。
```
## BM25
```md
那么 TF 和 IDF 谁更重要呢，怎么计算最终的相关性得分呢？那就是 BM25。
BM25算法，通常用来作搜索相关性平分。
```
* 主要思想
```md
对Query进行语素解析，生成语素qi；
然后，对于每个搜索结果D，计算每个语素 qi 与 D 的相关性得分，
最后，将 qi 相对于 D的相关性得分进行加权求和，从而得到 Query 与 D 的相关性得分。
```
```md
BM25 通过使用不同的语素分析方法、语素权重判定方法，以及语素与文档的相关性判定方法，
可以衍生出不同的搜索相关性得分计算方法，这就为设计算法提供了较大的灵活性。
```
### 4. 根据得到的文档和查询语句的相关性，对结果进行排序
#### 如何计算文档和查询语句的相关性呢？
```md
把查询语句看作一片短小的文档，对文档与文档之间的相关性(relevance)进行打分(scoring)，分数高的相关性好，就应该排在前面。
```
#### 那么又怎么对文档之间的关系进行打分呢？
```md
一个文档有很多词(Term)组成，对于文档之间的关系，不同的Term重要性不同。

判断文档之间的关系，首先找出哪些词(Term)对文档之间的关系最重要。
找出词(Term) 对文档的重要性的过程称为计算词的权重(Term weight) 的过程。
```
##### Term weight
```md
词的权重(Term weight)表示此词(Term)在此文档中的重要程度，越重要的词(Term)有越大的权重(Term weight)，
因而在计算文档之间的相关性中将发挥更大的作用。

判断词(Term) 之间的关系从而得到文档相关性的过程应用一种叫做向量空间模型的算法(Vector Space Model) 。
```
* 影响一个词(Term)在一篇文档中的重要性主要有两个因素：
```md
1. Term Frequency (tf)：即此Term在此文档中出现了多少次。tf 越大说明越重要。
2. Document Frequency (df)：即有多少文档包含Term。df 越大说明越不重要。
```
```md
词(Term)在文档中出现的次数越多，说明此词(Term)对该文档越重要，
如“搜索”这个词，在本文档中出现的次数很多，说明本文档主要就是讲这方面的事的。

然而在一篇英语文档中，this出现的次数更多，就说明越重要吗？
不是的，这是由第二个因素进行调整，第二个因素说明，
有越多的文档包含此词(Term), 说明此词(Term)太普通，不足以区分这些文档，因而重要性越低。
```
##### 向量空间模型的算法(VSM)
```md
把所有此文档中词(term)的权重(term weight) 看作一个向量。
Document = {term1, term2, …… ,term N}
Document Vector = {weight1, weight2, …… ,weight N}
```
```md
同样把查询语句看作一个简单的文档，也用向量来表示。
Query = {term1, term 2, …… , term N}
Query Vector = {weight1, weight2, …… , weight N}
```
```md
把所有搜索出的文档向量及查询向量放到一个N维空间中，每个词(term)是一维。
我们认为两个向量之间的夹角越小，相关性越大。
所以我们计算夹角的余弦值作为相关性的打分，夹角越小，余弦值越大，打分越高，相关性越大。
```